# 定性結果・不等号の表現
更新日: 2021/12/28

## 変換の趣旨
JAHIS臨床検査データ交換規約Ver.3.1では、

>『数値型の検査結果であっても比較演算子や接尾辞を持つ場合、値型が文字列STの場合と構造化数値SNの場合によって、検査結果値の表記が異なるので注意、例えば、ST型では100以上( >100 )や 2+であるが、SN型では >^100 や ^2^+ となる。可能な限りSN型を使用することを推奨する。』

としている。ここではSN型の表記例を挙げる。ただし、SS-MIX2 ver.1.2gではOBX-5(結果値）にSN型を許可していないため、本事業では『^』を半角スペースで置き換えST型で記載する。

## 正規表現について

Extended Regular Expressionで記載する。前後のスペースを除去したものに適用させることを想定している。
[regexper.com](http://regexper.com/) 等で視覚的に確認することが出来る。

## パターンファイル
[convert_to_sn.ptn](../master/convert_to_sn.ptn)

## 数値について
HL7 ver.2.5のNM型から正の記号を除いたものを【数値】とする。適宜読み替えること。

#### 【数値】の正規表現:

    \-?[0-9]+\.?[0-9]*|\-?\.[0-9]+

## 1.検出限界超の値

#### SN型での記載:

    >^【数値】

#### 正規表現:

    ^【数値】 ?(<|＜|〈)$
    ^(>|＞|〉|U) ?【数値】$
    ^【数値】超過

#### 変換前の例:

    100<
    100 <
    100＜
    100 ＜
    100〈
    100 〈
    >100
    > 100
    ＞100
    ＞ 100
    〉100
    〉 100
    100超過
    U100

## 2.検出限界以上の値

#### SN型での記載:

    >=^【数値】

#### 正規表現:

    ^【数値】 ?(≦|<=|=<|＜＝|＝＜)$
    ^【数値】 ?以上$
    ^(≧|>=|=>|＞＝|＝＞|↑) ?【数値】$
    ^【数値】 ?(～|↑)$

#### 変換前の例:

    200≦
    200 ≦
    200<=
    200 <=
    200=<
    200 =<
    200＜＝
    200 ＜＝
    200＝＜
    200 ＝＜
    200以上
    200 以上
    ≧200
    ≧ 200
    >=200
    >= 200
    =>200
    => 200
    ＞＝200
    ＞＝ 200
    ＝＞200
    ＝＞ 200
    200～
    200↑
    ↑200

## 3.検出限界未満の値

#### SN型での記載:

    <^【数値】

#### 正規表現:

    ^【数値】 ?(>|＞|〉)$
    ^【数値】 ?(未満|ミマン)$
    ^(<|＜|〈|L) ?【数値】$

#### 変換前の例:

    300>
    300 >
    300＞
    300 ＞
    300〉
    300 〉
    300未満
    300 未満
    300ミマン
    300 ミマン
    <300
    < 300
    ＜300
    ＜ 300
    〈300
    〈 300
    L300

## 4.検出限界以下の値

#### SN型での記載:

    <=^【数値】

#### 正規表現:

    ^【数値】 ?(≧|>=|=>|＞＝|＝＞)$
    ^【数値】 ?(以下|イカ|↓)$
    ^(≦|<=|=<|＜＝|＝＜|< =|↓) ?【数値】$

#### 変換前の例:

    400≧
    400 ≧
    400>=
    400 >=
    400=>
    400 =>
    400＞＝
    400 ＞＝
    400＝＞
    400 ＝＞
    400以下
    400 以下
    400イカ
    400 イカ
    ≦400
    ≦ 400
    <=400
    <= 400
    =<400
    =< 400
    ＜＝400
    ＜＝ 400
    ＝＜400
    ＝＜ 400
    < = 400
    400↓
    ↓400

## 5.定性結果(-)
#### SN型での記載:
    ^^-

#### 正規表現:

    ^([\-\－]|[\(（][\-\－] ?[\)）])$
    ^(陰性|インセイ)$
    ^(検出せず|検出セズ|ケンシュツセズ|ケンシユツセズ)$
    ^(フケンシュツ|フケンシユツ)$
    ^(ミケンシュツ|ミケンシユツ)$
    ^判定 （－）$
    ^\(\-\)インセイ$
    ^\(\-\) 陰性$

#### 変換前の例:

    -
    －
    (-)
    （-）
    インセイ
    陰性
    検出せず
    検出セズ
    ケンシュツセズ
    ケンシユツセズ
    フケンシュツ
    フケンシユツ
    ミケンシュツ
    ミケンシユツ
    (- )
    判定 （－）
    (-)インセイ
    (-) 陰性
    [-]
    [－]
    インセイ(-)

## 6.定性結果(+)
#### SN型での記載:
    ^^+

#### 正規表現:

    ^([\+\＋]|[\(（][\+\＋] ?[\)）])$
    ^(陽性|ヨウセイ|検出)$
    ^ヨウセイ\(\+\)$
    ^\(\+\)ヨウセイ$
    ^\(\+\) 陽性$
    ^★陽性★$

#### 変換前の例:

    +
    ＋
    （+）
    (+)
    （＋）
    (＋)
    ヨウセイ
    陽性
    検出
    (+ )
    ヨウセイ(+)
    (+)ヨウセイ
    (+) 陽性
    [+]
    [＋]
    ★陽性★
    
## 7.定性結果(+-)
#### SN型での記載:
    ^^+-

#### 正規表現:

    ^([\+＋]\/?[\-－]|[\-－]\/?[\+＋]|[\(（][\+＋]\/?[\-－ー][\)）])$
    ^([\(（]?±[\)）]?|[\(（]?＋－[\)）]?)$
    ^(少量(| 有| 無)|少数|少)$
    ^1\+↓$

#### 変換前の例:

    +-
    +/-
    (+-)
    （＋－）
    (+/-)
    (+/-）
    ±
    (±)
    （±）
    -/+
    ＋－
    1+↓
    少量
    少量 有
    少量 無
    少数
    少
    ＋/－
    (+ー)

## 8.定性結果（半定量）
    ^【1桁の正の整数】^+

#### 正規表現:

    ^([1-5１-５][\+＋]|\([1-5１-５][\+＋]\)|（[1-5１-５][\+＋]）)$
    ^(\(\+\+\)|\(＋＋\)|\+\+|＋＋)$
    ^(\(\+\+\+\)|\(＋＋＋\)|\+\+\+|＋＋＋)$
    ^(\(\+\+\+\+\)|\(＋＋＋＋\)|\+\+\+\+|＋＋＋＋)$
    ^(\(\+\+\+\+\+\)|\(＋＋＋＋＋\)|\+\+\+\+\+|＋＋＋＋＋)$
    ^[1-5]＋ 有$
    ^[1-5]＋ 無$

#### 変換前の例:

    1+
    (2+)
    ３＋
    （４＋）
    5+
    (++)
    ＋＋＋
    (＋＋＋＋)
    +++++
    1＋ 有
    1＋ 無

## 9.範囲
#### SN型での記載:

    ^【数値】^-^【数値】

#### 正規表現:

    ^【数値】(\-|～|~ ?)【数値】$
    ^≧【数値】＜【数値】$
    ^【数値】～【数値】未満$
    ^【数値】-<【数値】$
    ^【数値】(<|＜) ?【数値】 ?(未満|ミマン)$

#### 変換前の例:

    1-4
    0.5～2
    0.5~2
    ≧10＜20
    0.5～2未満
    0.5-<2.0
    1<5ミマン

## 10.比率
#### SN型での記載:
    ^【数値】^:^【数値】

#### 条件:

JLAC10が以下の場合に限る

    後日記載

#### 正規表現:

    ^【数値】(:|：)【数値】$

#### 変換前の例:

    後日記載

## 11.分数
#### SN型での記載:

    ^【数値】^/^【数値】

#### 条件:

JLAC10が以下の場合に限る

    1C030000004192001 細胞数[髄液]
    1C03500000419205[1-9] 細胞種類[髄液]
    2A160000001930963 血液像(自動機械法) 赤芽球
    2A160000001930985 血液像(自動機械法) 有核赤血球
    2A160000001931063 血液像(鏡検法) 赤芽球
    2A160000001931085 血液像(鏡検法) 有核赤血球
    2A170000004631077 骨髄像 骨髄巨核球

#### 正規表現:

    ^【数値】(\/|／)【数値】$

#### 変換前の例:

    1C030000004192001 細胞数[髄液]... 52/3
    1C035000004192051 細胞種類[髄液] リンパ球... 20/3
    1C035000004192053 細胞種類[髄液] 好中球... 7/3
    2A160000001930963 血液像 赤芽球... 2.0/300
    2A160000001931085 血液像(鏡検法) 有核赤血球... 15/200
    2A170000004631077 骨髄像 骨髄巨核球... 1/500

## 12.その他
検査結果としての妥当性は不明だが、出現があった場合以下の通り処理するものとする。

### 12.1定性結果（半定量）検出限界超
#### SN型での記載:

    >^【1桁の正の整数】^+

#### 出現例:

    >3+
